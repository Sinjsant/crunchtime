<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Info Windows</title>
    <style type="text/css">
#submit {
  background-color: gold;
  padding: .5em;
  -moz-border-radius: 5px;
  -webkit-border-radius: 5px;
  border-radius: 6px;
  color: white;
  font-family: 'Oswald';
  font-size: 13px;
  text-decoration: none;
  border: none;
  width: 100px;
}

</style>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
<div id="map"></div>
<script src="https://www.gstatic.com/firebasejs/5.5.7/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: //"Insert API Key",
    authDomain: "crunchtime-da4a8.firebaseapp.com",
    databaseURL: "https://crunchtime-da4a8.firebaseio.com",
    projectId: "crunchtime-da4a8",
    storageBucket: "crunchtime-da4a8.appspot.com",
    messagingSenderId: "851108485503"
  };
  firebase.initializeApp(config);
      // This example displays a marker at the center of Australia.
      // When the user clicks the marker, an info window opens.
      function initMap() {
        var uluru = {lat: -25.363, lng: 131.044};
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 4,
          center: uluru
        });
        var text = simpleLibrary("Moffitt");
    
        var infowindow = new google.maps.InfoWindow({
          content: text,
          maxWidth: 250
        });

        var marker = new google.maps.Marker({
          position: uluru,
          map: map,
          title: 'Uluru (Ayers Rock)'
        });
        marker.addListener('click', function() {
          infowindow.open(map, marker);
        });
      }
function updateData(ins, outs) {
var request = new XMLHttpRequest();
        request.open("GET", "https://crunchtime-da4a8.firebaseio.com/libraries/Moffitt.json", false);
        request.onload = function(){
            var data = JSON.parse(this.response);
            var dbRef = firebase.database().ref().child('libraries').child('Moffitt');
            dbRef.set({
            count: data.count + ins - outs
        });
        }
    }
    function simpleLibrary(library) {
    var request = new XMLHttpRequest();
        request.open("GET", "https://crunchtime-da4a8.firebaseio.com/libraries/" + library + ".json", false);
        request.onload = function(){
            var data = JSON.parse(this.response);
            seats = data.capacity - data.count;
            capacity = Math.round((data.count / data.capacity) * 100);
            image = data.image;
            updateData(5, 0);

            var d = new Date();
            var days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
            day = days[d.getDay()];
            if (day == "Friday" || day == "Saturday") {
                hours = data.weekend;
            } else {
                hours = data.weekday;
            }
            
            if (data.sound == true) {
                soundimage = 'https://i.imgur.com/d4fQUV5.png';
            } else {
                soundimage = 'https://i.imgur.com/QuEuwB4.png';
            }
            if (data.food == true) {
                foodimg = 'https://i.imgur.com/J896HT9.png';
            } else {
                foodimg = 'https://i.imgur.com/eZpInTj.png';
            }
        }
        request.send();

    var text = '<img src =' + image + ' width = "100%" height = "auto"><p style = "text-align: left; line-height: 5px;"><span style="font-size: 13pt; font-family: "book antiqua", palatino;"><strong>&nbsp;&nbsp;&nbsp;' + library + '&nbsp;</strong></span></p><p style = "text-align: left;line-height: 5px;"><span style="font-size: 10pt; font-family: "book antiqua", palatino;">&nbsp;&nbsp;&nbsp;&nbsp;<img src =' + soundimage + ' width = "7%" height = "auto">&nbsp;<img src = ' + foodimg + ' width = "7%" height = "auto">&nbsp;'+ day + '&nbsp;Hours: ' + hours + '</p><p style = "text-align: left;line-height: 10px;"><span style="font-family: "book antiqua", palatino;"><strong>&nbsp;&nbsp;&nbsp;Open Seats:&nbsp;' + seats + '&nbsp;</strong></span></p><p style = "text-align: left;line-height: 5px;"><span style="font-family: "book antiqua", palatino;"><strong>&nbsp;&nbsp;&nbsp;Capacity:&nbsp;' + capacity + '%&nbsp;full</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button id="submit" onclick="seeMore()">See More</button></span></p>';
    return text;
}
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDSacD24q7YLnP1HeFxUZXz-EMwreAxJf8&callback=initMap">
    </script>
  </body>
</html>